function Main() {}
Main.prototype = {
  initPreloading: function() {
    window.addEventListener("load", function() {
      document.body.classList = "loaded";
    });
    document.querySelector(".block.hero").addEventListener("click", this.particleRibbons());
  },
  trackPage: function(e) {
    (function(i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function() {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-50190232-1', 'akshatmittal.com');
    ga('require', 'displayfeatures');
    ga('send', 'pageview');

    if (window.location.protocol != "https:") window.location.href = "https:" + window.location.href.substring(window.location.protocol.length);
    if (self != top) top.location = self.location;
  },
  particleRibbons: function() {
    var c = document.getElementById("canvas__particles"),
      x = c.getContext('2d'),
      w = window.innerWidth,
      h = window.innerHeight,
      f = 180,
      q = [{}, {}],
      m = Math,
      r = 0,
      u = 0,
      v = m.cos,
      z = m.random,
      org = [],
      fin = [],
      tick;
    c.width = w;
    c.height = h;
    x.globalAlpha = 0.7;

    function i() {
      w = window.innerWidth;
      h = window.innerHeight;
      x.clearRect(0, 0, w, h);
      fin = [{
        x: 0,
        y: y(h) - f,
        sty: getColor()
      }, {
        x: 0,
        y: y(h) - f,
        sty: getColor()
      }];
      while (fin[fin.length - 1].x < w) {
        d(fin[fin.length - 2], fin[fin.length - 1]);
      }
      animate();
    }

    function draw() {
      x.clearRect(0, 0, w, h);
      var ii = 0;
      while (ii < org.length - 2) {
        x.beginPath();
        x.moveTo(org[ii].x, org[ii].y);
        x.lineTo(org[ii + 1].x, org[ii + 1].y);
        x.lineTo(org[ii + 2].x, org[ii + 2].y);
        x.closePath();
        x.fillStyle = fin[ii].sty;
        x.fill();
        ii++;
      }
    }

    function animate() {
      var xin = 0;
      if(org.length != fin.length) {
        org = fin;
      } else {
        while(xin < fin.length) {
          org[xin].x = (org[xin].x*9 + fin[xin].x)/10;
          org[xin].y = (org[xin].y*9 + fin[xin].y)/10;
          xin++;
        }
      }
      draw();
      cancelAnimationFrame(tick);
      tick = requestAnimationFrame(animate);
    }

    function d(i, j) {
      fin.push({
        x: j.x + f,
        y: y(j.y),
        sty: getColor()
      });
    }

    function y(p) {
      var t = p + (z() * 2.5 - 1.5) * f
      return (t > h || t < 0) ? y(p) : t
    }

    function getColor() {
      return "hsl("+ (u = (u+5)%360) +",100%, 50%)";
    }
    i();
    return i;
  },
  initMisc: function() {
    window.addEventListener("resize", this.particleRibbons);
  },
  initScroller: function() {
    window.addEventListener("scroll", function() {
      var x = document.body.scrollTop/window.innerHeight;
      var op = 1 - (x) * 1.2;
      if(op >= 0) document.querySelector(".block.hero").style.opacity = op;
      if(x > 1) {
        document.querySelector("section.gradiant").classList = "gradiant fixed";
      } else {
        document.querySelector("section.gradiant").classList = "gradiant";
      }
    });
  },
  init: function() {
    Main.trackPage();
    Main.initPreloading(), Main.particleRibbons(), Main.initScroller(), Main.initMisc();
  }
};
var Main = new Main;
Main.init();
